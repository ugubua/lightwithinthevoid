<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post — Light Within The Void</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .post-container{max-width:800px;margin:0 auto;padding:40px 20px}
    .post-title{font-family:'Playfair Display',serif;font-size:40px;margin:0 0 8px}
    .post-meta{color:var(--muted);margin-bottom:24px}
    .post-body img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
    .post-body a{color:var(--text)}
    .back-link{display:inline-block;margin-bottom:16px;text-decoration:none;color:var(--text)}
    .loader{opacity:.7}
    .error{color:#ffb3b3}
  </style>
</head>
<body>
<header class="site-header">
  <nav class="nav container">
    <a href="index.html" class="brand">
      <img src="assets/logo-mark.jpeg" alt="Light Within The Void mark" class="brand-logo">
      <span>Light Within The Void</span>
    </a>
    <button class="nav-toggle" aria-label="Open menu">☰</button>
    <ul class="nav-links">
      <li><a href="about.html">About</a></li>
      <li><a href="coaching.html">Coaching</a></li>
      <li><a href="podcast.html">Podcast</a></li>
      <li><a href="blog.html" class="active">Blog</a></li>
      <li><a href="testimonials.html">Testimonials</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="shop.html">Shop</a></li>
      <li><a href="subscribe.html" class="btn small subscribe-cta">Subscribe</a></li>
    </ul>
  </nav>
</header>

<main class="post-container">
  <a class="back-link" href="blog.html">← Back to Blog</a>
  <div id="post" class="post-body loader">Loading post…</div>
</main>

<script>
function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
function mdToHtml(md){
  md = md.replace(/\r\n?/g,'\n');
  md = md.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img alt="$1" src="$2">');
  md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>');
  md = md.replace(/```([\s\S]*?)```/g,(_,code)=>'<pre><code>'+escapeHtml(code)+'</code></pre>');
  md = md.replace(/`([^`]+)`/g,'<code>$1</code>');
  for (let i=6;i>=1;i--){const re=new RegExp('^'+'#'.repeat(i)+'\s+(.+)$','gm'); md=md.replace(re,`<h${i}>$1</h${i}>`);}
  md = md.replace(/\*\*([^*]+)\*\*/g,'<strong>$1</strong>');
  md = md.replace(/\*([^*]+)\*/g,'<em>$1</em>');
  md = md.replace(/^(?:- |\* )(.*(?:\n(?:- |\* ).*)*)/gm, m=>'<ul>'+m.split('\n').map(li=>li.replace(/^(- |\* )/,'')).map(t=>'\n<li>'+t+'</li>').join('')+'\n</ul>');
  md = md.replace(/^(?!<h\d>|<ul>|<pre>|<img|<blockquote|<p>|<code|<ol|<div)(.+)$/gm,'<p>$1</p>');
  return md;
}
function parseFrontmatter(md){
  const fmRe=/^---\n([\s\S]*?)\n---\n?/; const m=md.match(fmRe); const meta={}; let body=md;
  if(m){m[1].split(/\n/).forEach(line=>{const idx=line.indexOf(':'); if(idx>0){const k=line.slice(0,idx).trim(); const v=line.slice(idx+1).trim().replace(/^"|"$|^'|'$/g,''); meta[k]=v;}}); body=md.slice(m[0].length);}
  return {meta, body};
}
const params = new URLSearchParams(location.search); const file = params.get('p');
async function loadPost(){
  const el=document.getElementById('post');
  if(!file){el.textContent='No post specified.'; return;}
  try{
    const raw = 'https://raw.githubusercontent.com/ugubua/lightwithinvoid/main'+file;
    const res = await fetch(raw, {cache:'no-store'});
    if(!res.ok) throw new Error('Fetch failed '+res.status);
    const md = await res.text(); const {meta, body}=parseFrontmatter(md);
    const title=(meta.title||file.split('/').pop().replace(/[-_]/g,' ').replace(/\.md$/,''));
    const date = meta.date? new Date(meta.date).toLocaleDateString():'';
    const html = mdToHtml(body);
    const parts=title.split(' '); const first=parts.shift(); const rest=parts.join(' ');
    el.classList.remove('loader');
    el.innerHTML = `<h1 class="post-title"><span class="highlight">${first}</span> ${rest}</h1>`+(date?`<div class="post-meta">${date}</div>`:'')+html;
  }catch(e){
    el.classList.remove('loader'); el.classList.add('error'); el.textContent='Sorry, could not load this post.'; console.error(e);
  }
}
loadPost();
</script>
<script src="script.js"></script>
</body>
</html>
